@model FoodOrderingSystem.Controllers.ReferralProgramViewModel

@{
    ViewData["Title"] = "Referral Program";
}

@section Styles {
    <link rel="stylesheet" href="~/css/deals.css" asp-append-version="true" />
}

<div class="referral-program-container">
    <div class="container">
        <!-- Page Header -->
        <div class="text-center mb-5">
            <h1 class="display-4">
                <i class="fas fa-users text-success me-3"></i>Referral Program
            </h1>
            <p class="lead">Refer friends and earn rewards together!</p>
        </div>

        <!-- Referral Summary -->
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0"><i class="fas fa-chart-line me-2"></i>Your Referral Summary</h4>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="referral-stat">
                                    <h3 class="text-success">@Model.Referrals.Count</h3>
                                    <small class="text-muted">Friends Referred</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="referral-stat">
                                    <h3 class="text-warning">RM@Model.TotalCredits.ToString("F2")</h3>
                                    <small class="text-muted">Total Credits Earned</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="referral-stat">
                                    <h3 class="text-primary">@Model.User.ReferralCount</h3>
                                    <small class="text-muted">Successful Referrals</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Your Referral Code -->
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-share-alt me-2"></i>Your Referral Code</h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="referral-code-display mb-3">
                            <span class="referral-code-text">@Model.User.ReferralCode</span>
                            <button class="btn btn-outline-primary copy-btn" data-code="@Model.User.ReferralCode">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <p class="text-muted">Share this code with your friends to earn rewards!</p>
                        
                        <!-- Share Buttons -->
                        <div class="share-buttons">
                            <button class="btn btn-outline-success me-2" onclick="shareOnWhatsApp()">
                                <i class="fab fa-whatsapp me-2"></i>WhatsApp
                            </button>
                            <button class="btn btn-outline-primary me-2" onclick="shareOnFacebook()">
                                <i class="fab fa-facebook me-2"></i>Facebook
                            </button>
                            <button class="btn btn-outline-info me-2" onclick="shareOnTwitter()">
                                <i class="fab fa-twitter me-2"></i>Twitter
                            </button>
                            <button class="btn btn-outline-secondary" onclick="copyToClipboard()">
                                <i class="fas fa-link me-2"></i>Copy Link
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <div class="row mb-5">
            <div class="col-lg-10 mx-auto">
                <div class="card bg-light">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>How the Referral Program Works</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="step-item mb-4">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h6>Share Your Code</h6>
                                        <p>Share your unique referral code with friends and family</p>
                                    </div>
                                </div>
                                <div class="step-item mb-4">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h6>Friend Signs Up</h6>
                                        <p>Your friend uses your code when creating their account</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="step-item mb-4">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h6>Friend Places Order</h6>
                                        <p>Your friend places their first order and gets RM5 credit</p>
                                    </div>
                                </div>
                                <div class="step-item mb-4">
                                    <div class="step-number">4</div>
                                    <div class="step-content">
                                        <h6>You Get Rewarded</h6>
                                        <p>You receive RM10 credit when your friend completes their first order</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Referral Benefits -->
        <div class="row mb-5">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-gift me-2"></i>Referral Benefits</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="benefit-card text-center mb-3">
                                    <i class="fas fa-gift text-success fa-3x mb-3"></i>
                                    <h6>You Get</h6>
                                    <ul class="list-unstyled">
                                        <li>✓ RM10 credit per referral</li>
                                        <li>✓ 50 bonus points per referral</li>
                                        <li>✓ Credits can be used on any order</li>
                                        <li>✓ No limit on referrals</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="benefit-card text-center mb-3">
                                    <i class="fas fa-heart text-danger fa-3x mb-3"></i>
                                    <h6>Your Friend Gets</h6>
                                    <ul class="list-unstyled">
                                        <li>✓ RM5 credit on first order</li>
                                        <li>✓ Welcome bonus points</li>
                                        <li>✓ Access to all deals</li>
                                        <li>✓ Member benefits</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Your Referrals -->
        @if (Model.Referrals.Any())
        {
            <div class="row mb-5">
                <div class="col-lg-8 mx-auto">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-users me-2"></i>Your Referrals</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Friend</th>
                                            <th>Email</th>
                                            <th>Joined Date</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var referral in Model.Referrals)
                                        {
                                            <tr>
                                                <td>
                                                    <strong>@referral.FirstName @referral.LastName</strong>
                                                </td>
                                                <td>@referral.Email</td>
                                                <td>@referral.CreatedAt.ToString("MMM dd, yyyy")</td>
                                                <td>
                                                    @if (referral.ReferralCredits > 0)
                                                    {
                                                        <span class="badge bg-success">Completed</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="badge bg-warning text-dark">Pending</span>
                                                    }
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="row mb-5">
                <div class="col-lg-6 mx-auto">
                    <div class="card bg-light text-center">
                        <div class="card-body">
                            <i class="fas fa-users fa-3x text-muted mb-3"></i>
                            <h5>No Referrals Yet</h5>
                            <p class="text-muted">Start sharing your referral code to see your friends here!</p>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Terms & Conditions -->
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="alert alert-info">
                    <h6><i class="fas fa-info-circle me-2"></i>Terms & Conditions</h6>
                    <ul class="mb-0">
                        <li>Referral credits are awarded after your friend completes their first order</li>
                        <li>Credits can be used on any future order</li>
                        <li>There is no limit to the number of friends you can refer</li>
                        <li>Referral program is subject to change without notice</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Copy referral code functionality
            $('.copy-btn').on('click', function() {
                const code = $(this).data('code');
                navigator.clipboard.writeText(code).then(function() {
                    const $btn = $(this);
                    const originalText = $btn.html();
                    $btn.html('<i class="fas fa-check"></i>');
                    $btn.removeClass('btn-outline-primary').addClass('btn-success');
                    
                    setTimeout(function() {
                        $btn.html(originalText);
                        $btn.removeClass('btn-success').addClass('btn-outline-primary');
                    }, 2000);
                });
            });
        });

        function copyToClipboard() {
            const referralCode = '@Model.User.ReferralCode';
            const referralLink = `${window.location.origin}/Account/Register?ref=${referralCode}`;
            navigator.clipboard.writeText(referralLink);
            alert('Referral link copied to clipboard!');
        }

        function shareOnWhatsApp() {
            const referralCode = '@Model.User.ReferralCode';
            const message = `Join MackDihh and get RM5 credit on your first order! Use my referral code: ${referralCode}`;
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function shareOnFacebook() {
            const referralCode = '@Model.User.ReferralCode';
            const message = `Join MackDihh and get RM5 credit on your first order! Use my referral code: ${referralCode}`;
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.origin)}&quote=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        function shareOnTwitter() {
            const referralCode = '@Model.User.ReferralCode';
            const message = `Join MackDihh and get RM5 credit on your first order! Use my referral code: ${referralCode}`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }
    </script>
} 